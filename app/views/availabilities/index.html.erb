<% provide(:title, 'Swap availability') %>

<h1>Your swap availabilty</h1>

<div>
  <ul class="availabilities">
    <% if @availabilities.empty? %>
      <h2>You don't have any swap availability. You should add someâ€¦</h2>
    <% end %>
    <% @availabilities.each do |availability| %>
      <li>
        <%= availability %>
        <% if availability.tentative? %>
           <%= link_to availability.request do %>
            <button type="button" class="btn btn-default btn-xs" aria-label="Left Align" title="Tentatively committed">
              <span class="glyphicon glyphicon-transfer" aria-hidden="true"></span>
            </button>
           <% end %>
        <% elsif current_user_can_edit?(availability) %>
          <%= link_to availability, method: :delete, data: { confirm: "Really delete this availability?" } do %>
            <button type="button" class="btn btn-default btn-xs" aria-label="Left Align" title="Delete">
              <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
            </button>
          <% end %>
        <% end %>
      </li>
    <% end %>
  </ul>
</div>

<%= render partial: 'availabilities/new', locals: {availability: @availability} %>

<h1>Suggested availability</h1>

<p>These shifts need swaps. Check all the ones you're available for, then click the "Add suggested" button.</p>

<%= form_for(@user, url: update_availability_url(@user)) do |f| %>
  <%= f.fields_for :availabilities, @suggested_availabilities do |availability_fields| %>
      <%= availability_fields.label availability_fields.object, { class: "checkbox" } do %>
        <%= check_box_tag availability_fields.object_name + "[create]" %>
        <%= availability_fields.object %>
        <%= availability_fields.hidden_field :date %>
        <%= availability_fields.hidden_field :shift %>
      <% end %>
  <% end %>
  <%= f.submit "Add suggested" %>
<% end %>

<% if @unavailabilities.any? %>
  <h1>Shifts you have expressed unavailabitity for</h1>
  <div>
    <ul class="availabilities">
      <% @unavailabilities.each do |unavailability| %>
        <li><%= unavailability %></li>
      <% end %>
    </ul>
  </div>
<% end %>